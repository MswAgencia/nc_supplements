!function(t){t.fn.openpos=function(){function e(){return Mustache.render("{{close_warning}}",lang)}function a(e){t.indexedDB(F,{schema:{1:function(t){var e=(t.createObjectStore("pos",{keyPath:"key"}),t.createObjectStore("category",{keyPath:"category_id"}));e.createIndex("category_id");var a=t.createObjectStore("product",{keyPath:"product_id"});a.createIndex("upc",{unique:!1}),a.createIndex("product_id",{unique:!1});var o=t.createObjectStore("cart",{keyPath:"id",autoIncrement:!0});o.createIndex("product_id",{unique:!1}),o.createIndex("type",{unique:!1});var i=t.createObjectStore("order",{keyPath:"id",autoIncrement:!0});i.createIndex("status",{unique:!1});var n=t.createObjectStore("tax",{keyPath:"tax_rule_id"});n.createIndex("customer_group_id",{unique:!1}),n.createIndex("tax_class_id",{unique:!1}),n.createIndex("based",{unique:!1});var r=t.createObjectStore("cart_saved",{keyPath:"id",autoIncrement:!0});r.createIndex("name",{unique:!1})}}}).done(function(){t.indexedDB(F).objectStore("pos").clear(),t.indexedDB(F).objectStore("category").clear(),t.indexedDB(F).objectStore("product").clear(),t.indexedDB(F).objectStore("tax").clear(),t.indexedDB(F).objectStore("cart").clear(),t.indexedDB(F).objectStore("cart_saved").clear()}).then(function(){o(function(){t("#container #content #content-loading").remove(),t("#content .box").show()},0),void 0!=e&&e()})}function o(e,a){t.ajax({type:"GET",url:data_url+"&page="+a,dataType:"json",beforeSend:function(){0==a&&(t("#container #content").append('<div id="content-loading">Loading....!!!! Please wait....!</div>'),t("#content .box").hide()),t("#status").removeClass("ok").addClass("lock")},success:function(i){var r=t.indexedDB(F).objectStore("product"),c=t.indexedDB(F).objectStore("pos"),l=t.indexedDB(F).objectStore("category"),u=(t.indexedDB(F).objectStore("zone"),t.indexedDB(F).objectStore("tax"));t.each(i.products,function(t,e){r.add(e)}),0==a&&(t.each(i.pos,function(t,e){c.add(e)}),t.each(i.categories,function(t,e){l.add(e)}),t.each(i.tax,function(t,e){u.add(e)}),t("#container #content #content-loading").remove(),t("#content .box").show(),n(),t(".product-pad button[value='0']").trigger("click"),d(),void 0!=e&&e()),i.page!=a?(a+=1,o(e,a)):(n(),t(".product-pad button[value='0']").trigger("click"),t("#status").removeClass("lock").addClass("ok"))}})}function n(){t(".jcarousel ul").empty(),t(".jcarousel ul").append('<li><button id="category-btn" value="0">'+Mustache.render("{{all_category}}",lang)+"</button></li>"),t(".jcarousel").jcarousel("reload"),t.indexedDB(F).objectStore("category").each(function(e){t(".jcarousel ul").append('<li><button id="category-btn" value="'+e.value.category_id+'">'+e.value.name+"("+e.value.total+")</button></li>"),t(".jcarousel").jcarousel("reload")}),t("#categories").on("click","#category-btn",function(){var e=this;t("#categories li button").each(function(){t(this).removeClass("cat-active")}),t(e).addClass("cat-active"),0==t(e).attr("value")?r(0,"next"):(t("#ajaxproducts").attr("last-category",t(e).attr("value")),c(t(e).attr("value"),0,"next"))}),t("#pro-control-next").on("click",function(){if(t(this).hasClass("active")){var e=t("#ajaxproducts").attr("last-category"),a=t("#ajaxproducts").attr("last-product");if("0"==e)r(a,"next");else{var o=t("#ajaxproducts").attr("last-category");c(o,a,"next")}}}),t("#pro-control-prev").on("click",function(){if(t(this).hasClass("active")){var e=t("#ajaxproducts").attr("last-category"),a=t("#ajaxproducts").attr("last-product");if("0"==e)r(a,"prev");else{var o=t("#ajaxproducts").attr("last-category");c(o,a,"prev")}}})}function r(e,a){t("#ajaxproducts ul").empty(),t("#ajaxproducts").attr("last-category",0);var o=20,i=t.indexedDB(F).objectStore("product"),n=0,r=IDBKeyRange.lowerBound(e);"next"!=a?(r=IDBKeyRange.upperBound(e),a="prev"):a="next";var c="";i.index("product_id").each(function(e){var a="instock";return e.value.quantity<=0&&(a="outstock"),c+='<div id="product-container"><div class="product-info" product-data="'+e.value.product_id+'"><div class="'+a+' product-stock">'+e.value.quantity+'</div><img src="'+e.value.image+'"><p>'+e.value.name+"</p></div></div>",t("#ajaxproducts").attr("last-product",e.value.product_id),n>=o-1?!1:void n++},r,a).done(function(){t("#ajaxproducts ul").empty(),t("#ajaxproducts ul").append('<li style="width:'+t("#ajaxproducts").width()+'px;">'+c+"</li>"),""==c||o-1>n?"next"!=a?t("#pro-control-prev").removeClass("active").addClass("inactive"):t("#pro-control-next").removeClass("active").addClass("inactive"):"next"!=a?t("#pro-control-prev").addClass("active"):t("#pro-control-next").addClass("active"),n==o-1&&(t("#pro-control-prev").removeClass("inactive").addClass("active"),t("#pro-control-next").removeClass("inactive").addClass("active"))})}function c(e,a,o){t("#ajaxproducts ul").empty();var i=t.indexedDB(F).objectStore("product"),n=(t.indexedDB(F).objectStore("category"),20),r=0,c=IDBKeyRange.lowerBound(a);"next"!=o?(c=IDBKeyRange.upperBound(a),o="prev"):o="next";var l="";i.index("product_id").each(function(a){if(t("#ajaxproducts").attr("last-product",a.value.product_id),a.value.category_id&&-1!=a.value.category_id.indexOf(e)){var o="instock";if(a.value.quantity<=0&&(o="outstock"),l+='<div id="product-container"><div class="product-info" product-data="'+a.value.product_id+'"><div class="'+o+' product-stock">'+a.value.quantity+'</div><img src="'+a.value.image+'"><p>'+a.value.name+"</p></div></div>",r>=n-1)return!1;r++}},c,o).done(function(){t("#ajaxproducts ul").empty(),t("#ajaxproducts ul").append('<li style="width:'+t("#ajaxproducts").width()+'px;">'+l+"</li>"),""==l||n-1>r?"next"!=o?t("#pro-control-prev").removeClass("active").addClass("inactive"):t("#pro-control-next").removeClass("active").addClass("inactive"):"next"!=o?t("#pro-control-prev").addClass("active"):t("#pro-control-next").addClass("active"),r==n-1&&(t("#pro-control-prev").removeClass("inactive").addClass("active"),t("#pro-control-next").removeClass("inactive").addClass("active"))})}function l(){var e=t.indexedDB(F).objectStore("product"),a=t.indexedDB(F).objectStore("cart");t("#ajaxproducts").on("click",".product-info",function(){var o=t(this).attr("product-data"),i=!1;e.get(o).done(function(t){a.index("product_id").each(function(e){0==t.options.length&&(i=!0,e.value.qty=e.value.qty+1,e.value.subtotal=String(parseFloat(e.value.subtotal)+parseFloat(e.value.price)),a.put(e.value).done(function(){d()}))},o).done(function(){i||e.get(o).done(function(t){h(t.product_id,1,function(e){var o=new Object;o.price=e.price,o.price_no_opt=e.price,o.base_price=e.base_price,o.qty=1,o.dummy=t.dummy,o.name=t.name,o.model=t.model,o.point=t.points,o.type="product",o.product_id=t.product_id,o.options=new Array,o.subtotal=e.price,o.tax_class_id=t.tax_class_id,o.tax=new Object,o.tax.total=0,o.tax.tax=new Array,o.tax.modified=!1,a.add(o).done(function(t){g(t,function(){d()})}).then(function(){})})})})})})}function d(){var e=t.indexedDB(F).objectStore("cart"),a=t.indexedDB(F).objectStore("product");t("#product-cart-list table").empty(),t("#product-cart-list").jScrollPane({showArrows:!0}).data("jsp").scrollToBottom(),e.index("type").each(function(e){var o=e.value.product_id,n=0;e.value.tax.total&&(n=e.value.tax.total),a.get(o).done(function(a){y(e.value.base_price,function(o){y(e.value.price,function(r){y(e.value.subtotal,function(c){y(n,function(l){var d="";if(o!=r&&(d='<p><span id="old_price">'+o+"</span></p>"),1==a.dummy){var u=config.currency.number_format;r='<input type="text" name="item_price" item_id="'+e.value.id+'" id="item_price" value="'+numeral(e.value.price).format(u)+'">'}if(parseFloat(n)>0)var s='<tr id="row-'+e.value.id+'"><td class="del-col" product-data="'+e.value.id+'">x</td><td class="product-col"><p>'+a.name+'</p></td><td class="price-col"><p>'+r+"</p>"+d+'</td><td class="tax-col"><button type="button" product-data="'+e.value.id+'">'+l+'</button></td><td class="qty-col"><div id="qty-plus" product-data="'+e.value.id+'"></div><input type="text" id="input-qty" name="qty" value="'+e.value.qty+'"/><div id="qty-less" product-data="'+e.value.id+'"></div></td><td class="subtotal-col">'+c+'</td><td class="non-option-col" product-data="'+e.value.id+'"></td></tr>';else var s='<tr id="row-'+e.value.id+'"><td class="del-col" product-data="'+e.value.id+'">x</td><td class="product-col"><p>'+a.name+'</p></td><td class="price-col"><p>'+r+"</p>"+d+'</td><td class="tax-col">'+l+'</td><td class="qty-col"><div id="qty-plus" product-data="'+e.value.id+'"></div><input type="text" id="input-qty" name="qty" value="'+e.value.qty+'"/><div id="qty-less" product-data="'+e.value.id+'"></div></td><td class="subtotal-col">'+c+'</td><td class="non-option-col" product-data="'+e.value.id+'"></td></tr>';if(a.options.length>0){var p=e.value.options,v=new Array,m=new Array,f=!0;for(i in p){var _=p[i];m.push(_.product_option_id)}console.log(a.options);for(i in a.options){var _=a.options[i];("select"==_.type||"radio"==_.type||"checkbox"==_.type||"image"==_.type||"date"==_.type)&&1==_.required&&v.push(_.product_option_id)}if(v.length>0)for(i in v)-1==m.indexOf(v[i])&&(f=!1);var h="";f||(h='class="require"');var y="";if(e.value.options.length>0){y+='<p id="option_str">';for(i in e.value.options){var g=e.value.options[i];y+="text"==g.type?g.name+" : "+g.product_option_value_id+"; ":g.name+": "+g.value+"; "}y+="</p>"}s=parseFloat(n)>0?"<tr "+h+' id="row-'+e.value.id+'"><td class="del-col" product-data="'+e.value.id+'">x</td><td class="product-col"><p>'+a.name+"</p>"+y+'</td><td class="price-col"><p>'+r+"</p>"+d+'</td><td class="tax-col"><button type="button" product-data="'+e.value.id+'">'+l+'</button></td><td class="qty-col"><div id="qty-plus" product-data="'+e.value.id+'"></div><input type="text" id="input-qty" name="qty" value="'+e.value.qty+'"/><div id="qty-less" product-data="'+e.value.id+'"></div></td><td class="subtotal-col">'+c+'</td><td class="option-col" product-data="'+e.value.id+'"></td></tr>':"<tr "+h+'  id="row-'+e.value.id+'"><td class="del-col" product-data="'+e.value.id+'">x</td><td class="product-col"><p>'+a.name+"</p>"+y+'</td><td class="price-col"><p>'+r+"</p>"+d+'</td><td class="tax-col">'+l+'</td><td class="qty-col"><div id="qty-plus" product-data="'+e.value.id+'"></div><input type="text" id="input-qty" name="qty" value="'+e.value.qty+'"/><div id="qty-less" product-data="'+e.value.id+'"></div></td><td class="subtotal-col">'+c+'</td><td class="option-col" product-data="'+e.value.id+'"></td></tr>'}t("#product-cart-list table").append(s),t("#product-cart-list").jScrollPane({showArrows:!0}).data("jsp").scrollToBottom()})})})})})},"product").then(function(){x(),t("#scancode").focus()})}function u(e){var a=t.indexedDB(F).objectStore("order");if(e.length>0){t("#status").removeClass("ok").addClass("lock");for(i in e){var o=e[i];if(0==o.status){o.status=2,a.put(o).done(function(){t.ajax({type:"POST",url:data_url,dataType:"json",data:{action:"order",data:JSON.stringify(o)},beforeStart:function(){t("#status").removeClass("ok").addClass("lock")},success:function(){e.shift(),u(e)},error:function(){o.status=0,a.put(o).done(function(){u(e)})}})});break}}}else t("#status").removeClass("lock").addClass("ok")}function s(e){var a=t.indexedDB(F).objectStore("order");if(e.length>0){t("#status").removeClass("ok").addClass("lock");for(i in e){var o=e[i];if(1==o.canceled){o.canceled=2,a.put(o).done(function(){t.ajax({type:"POST",url:data_url,dataType:"json",data:{action:"cancel",data:JSON.stringify(o)},beforeStart:function(){t("#status").removeClass("ok").addClass("lock")},success:function(){e.shift(),s(e)},error:function(){o.canceled=1,a.put(o).done(function(){s(e)})}})});break}}}else t("#status").removeClass("lock").addClass("ok")}function p(){var e=t.indexedDB(F).objectStore("cart"),a=t.indexedDB(F).objectStore("product"),o=t.indexedDB(F).objectStore("order"),n=new Array;setInterval(function(){o.index("status").each(function(t){n.push(t.value)},0).then(function(){u(n)})},5e3);var n=new Array;setInterval(function(){o.index("status").each(function(t){void 0!=t.value.canceled&&1==t.value.canceled&&n.push(t.value)},2).then(function(){s(n)})},5e3),setInterval(function(){o.index("status").each(function(t){var e=new Date,a=Math.round(e.getTime()/1e3);if(t.value.created_time||(t.value.created_time=0),a-parseInt(t.value.created_time)>86400){var i=t.value.id;o["delete"](parseInt(i))}},2)},1e3),t("#botbuttons #cancel").click(function(){var a=t("<div>"+Mustache.render("{{clear_cart_warning}}",lang)+"</div>");t(".ui-dialog-titlebar-close").trigger("click"),a.dialog({title:Mustache.render("{{clear_cart_title}}",lang),modal:!0,overlay:{backgroundColor:"#000",opacity:.5},buttons:{Apply:function(){var a=t(this);e.clear().done(function(){t("#total_paid input").val("0"),d(),a.dialog("close").remove()})},Cancel:function(){return t(this).dialog("close").remove(),!1}}})}),t("#pro-col-header .del-col").click(function(){t("#botbuttons #cancel").trigger("click")}),t("#product-cart-list").on("click",".del-col",function(){if(t(this).attr("product-data")){var a=t(this).attr("product-data");e["delete"](parseInt(a)).done(function(){d()})}}),t("#product-cart-list").on("click","#qty-plus",function(){if(t(this).attr("product-data")){var a=t(this).attr("product-data");e.get(parseInt(a)).done(function(t){var a=t.qty+1;h(t.product_id,a,function(o){var i=parseFloat(o.price)*parseInt(a),n=o.price;t.options.length>0&&(t.opt_total_price&&(n=parseFloat(o.price)+parseFloat(t.opt_total_price),i=n*parseInt(a)),t.opt_total_price&&parseFloat(o.price)>parseFloat(parseFloat(t.price)-parseFloat(t.opt_total_price))&&(i=parseFloat(t.price)*parseInt(a),n=t.price)),t.price=n,t.qty=a,t.subtotal=i,e.put(t).done(function(){d()})})})}}),t("#product-cart-list").on("click","#qty-less",function(){if(t(this).attr("product-data")){var a=t(this).attr("product-data");e.get(parseInt(a)).done(function(t){if(t.qty>0){var a=t.qty-1;h(t.product_id,a,function(o){var i=parseFloat(o.price)*parseInt(a),n=o.price;t.options.length>0&&(t.opt_total_price&&(n=parseFloat(o.price)+parseFloat(t.opt_total_price),i=n*parseInt(a)),t.opt_total_price&&parseFloat(o.price)>parseFloat(parseFloat(t.price)-parseFloat(t.opt_total_price))&&(i=parseFloat(t.price)*parseInt(a),n=t.price)),t.price=n,t.qty=a,t.subtotal=i,e.put(t).done(function(){d()})})}})}}),t("#product-cart-list").on("click",".option-col",function(){if(t(this).attr("product-data")){var e=parseInt(t(this).attr("product-data"));f(e,function(a){_(a.product_id,function(o){var n=o.options,r=a.options,c='<div><form id="option-'+e+'">',l=new Array,u="",s=new Array;for(i in n){var p=n[i],v=new Array,f="";for(j in r){var _=r[j];_.product_option_id==p.product_option_id&&v.push(_.product_option_value_id)}if(1==p.required?(l.push(p.option_id),("select"==p.type||"checkbox"==p.type||"radio"==p.type||"text"==p.type)&&s.push("option_"+p.product_option_id),u='<span id="require">*</span>',f="option-require"):f="","select"==p.type){c+='<div class="select-option" id="option_'+p.product_option_id+'">'+p.name+u+': <select name="option_'+p.product_option_id+'" class="'+f+'">',c+='<option value=""></option>';for(j in p.option_value){var h=p.option_value[j],y="";if(y=v.indexOf(h.option_value_id)>-1?' selected="selected" ':"",h.price){var g=config.currency.number_format,b=numeral(h.price).format(g);c+="<option "+y+' value="'+h.option_value_id+'">'+h.name+"("+h.price_prefix+b+")</option>"}else c+="<option "+y+' value="'+h.option_value_id+'">'+h.name+"</option>"}c+="</select></div>"}if("radio"==p.type){c+='<div class="radio-option">'+p.name+u+":<ul>";for(k in p.option_value){var h=p.option_value[k],y="";if(y=v.indexOf(h.option_value_id)>-1?' checked="checked" ':"",h.price){var g=config.currency.number_format,b=numeral(h.price).format(g);c+='<li><input class="'+f+'"  '+y+'  type="radio" name="option_'+p.product_option_id+'" value="'+h.option_value_id+'">'+h.name+"("+h.price_prefix+b+")</li>"}else c+='<li><input class="'+f+'"  '+y+'  type="radio" name="option_'+p.product_option_id+'" value="'+h.option_value_id+'">'+h.name+"</li>"}c+="</ul></div>"}if("image"==p.type){c+='<div class="radio-option">'+p.name+u+":<ul>";for(k in p.option_value){var h=p.option_value[k],y="";if(y=v.indexOf(h.option_value_id)>-1?' checked="checked" ':"",h.price){var g=config.currency.number_format,b=numeral(h.price).format(g);c+='<li><input class="'+f+'"  '+y+'  type="radio" name="option_'+p.product_option_id+'" value="'+h.option_value_id+'"><img src="'+h.image+'" width="15px" height="15px"> '+h.name+"("+h.price_prefix+b+")</li>"}else c+='<li><input class="'+f+'"  '+y+'  type="radio" name="option_'+p.product_option_id+'" value="'+h.option_value_id+'"><img src="'+h.image+'" width="15px" height="15px"> '+h.name+"</li>"}c+="</ul></div>"}if("checkbox"==p.type){c+='<div class="checkbox-option">'+p.name+u+":<ul>";for(k in p.option_value){var h=p.option_value[k],y="";y=v.indexOf(h.option_value_id)>-1?' checked="checked" ':"";var g=config.currency.number_format,b=numeral(h.price).format(g);c+='<li> <input class="'+f+'"  '+y+' type="checkbox" name="option_'+p.product_option_id+'" value="'+h.option_value_id+'">'+h.name+"("+h.price_prefix+b+") </li>"}c+="</ul></div>"}if("text"==p.type||"date"==p.type){var x=p.option_value;""!=v&&(x=v),c+='<div class="checkbox-option">'+p.name+u+":",c+=' <input class="'+f+'" type="text" name="option_'+p.product_option_id+'" value="'+x+'">',c+="</div>"}}c+="</form></div>",t(".ui-dialog-titlebar-close").trigger("click"),t(c).dialog({title:o.name,modal:!0,overlay:{backgroundColor:"#000",opacity:.5},buttons:{Apply:function(){var a=o.options,n=t("form#option-"+e).serializeArray(),r=new Array,c=t(this);for(i in n){var l=n[i].name,u=s.indexOf(l);if(-1!=u&&(s.splice(u,1),""==n[i].value))return alert("Please choose require option."),!1}if(s.length>0)return alert("Please choose require option."),!1;for(i in n){var p=n[i],v=new Object,f=p.name.split("_");v.product_option_id=f[1],v.product_option_value_id=p.value;for(j in a){var _=a[j];if(_.product_option_id==f[1])if(v.name=_.name,v.type=_.type,"text"==_.type||"date"==_.type)v.value=v.product_option_value_id;else for(k in _.option_value){var h=_.option_value[k];h.option_value_id==v.product_option_value_id&&(v.value=h.name,v.price_prefix=h.price_prefix,v.price=h.price)}}r.push(v)}m(e,r,function(){d(),c.dialog("close").remove()})},Cancel:function(){return t(this).dialog("close").remove(),!1}}})})})}}),t("#product-cart-list").on("click",".tax-col button",function(){var a=t(this).attr("product-data"),o='<div><div id="tax_popup"><form id="tax_form" onsubmit="return false;"><ul>';e.get(parseInt(a)).done(function(e){var a=e.tax,n=config.currency.number_format;for(i in a.tax){var r=a.tax[i],c=numeral(r.tax_price).format(n);o+='<li><div id="tax-title">'+r.name+':</div><div id="tax-value">'+c+"</div></li>"}numeral(e.total).format(n);o+="</ul></form></div></div>",t(".ui-dialog-titlebar-close").trigger("click"),t(o).dialog({title:"Tax Details",modal:!0,overlay:{backgroundColor:"#000",opacity:.5},buttons:{Cancel:function(){return t(this).dialog("close").remove(),!1}}})})}),t("#totaldiv").on("click","#discount_button",function(){var a='<div><div id="discount-message"></div><form id="discount_form" onSubmit="return false;"><ul>';a+='<li><input type="radio" name="discount" value="egift"/>Use Gift Card</li>',e.index("type").each(function(e){e.value.id!=parseInt(config.default_customer.customer_id)&&(a='<li><input type="radio" name="discount" value="coupon"/>Use Reward Point</li>',t("li#custom").after(a))},"customer"),a+='<li id="custom"><input type="radio" name="discount" value="custom"/>Custom</li>',a+='<li id="dicount_input"></li>',a+="</ul></form></div>",t(".ui-dialog-titlebar-close").trigger("click"),t(a).dialog({title:"Discount Details",modal:!0,overlay:{backgroundColor:"#000",opacity:.5},buttons:{Apply:function(){var a=t("input:radio[name='discount']:checked").val(),o=t(this);if("egift"==a){var i=t("input[name='egift_code']").val();""==i?t("#discount-message").html("Please enter your gift voucher code!"):t.ajax({url:data_url,type:"GET",data:{action:"checkegift",code:i},dataType:"json",success:function(a){if(0==a.status)t("#discount-message").html("Your gift voucher code invalid !");else{var i=!1;e.index("type").each(function(t){i=!0;var n=t.value;n.value.egift=a.info,e.put(n).done(function(){d(),o.dialog("close").remove()})},"discount").then(function(){i||(tmp=new Object,tmp.type="discount",tmp.value=new Array,tmp.value.egift=a.info,e.add(tmp).done(function(){d(),o.dialog("close").remove()}))})}}})}if("custom"==a){var n=t("input[name='coupon_code']").val(),r=t("select[name='custom_type']").val();if(""==n)t("#discount-message").html("Please enter discount amount!");else{var c=!1;e.index("type").each(function(t){c=!0;var a=t.value,i=new Object;i.type=r,i.price=n,i.total=(r="F")?n:0,a.value.custom=i,e.put(a).done(function(){d(),o.dialog("close").remove()})},"discount").then(function(){if(!c){tmp=new Object,tmp.type="discount",tmp.value=new Array;var t=new Object;t.type=r,t.price=n,t.total=(r="F")?n:0,tmp.value.custom=t,e.add(tmp).done(function(){d(),o.dialog("close").remove()})}})}}},Cancel:function(){return t(this).dialog("close").remove(),!1}}}),t("input:radio[name='discount']").click(function(){var e=t("input:radio[name='discount']:checked").val();"custom"==e&&t("#dicount_input").html('<input type="text" placeholder="Enter amount" name="coupon_code" value="" id="coupon_code"><select name="custom_type"><option value="F">fixed</option><option value="P">Pecentage</option></select>'),"egift"==e&&t("#dicount_input").html('<input type="text" placeholder="Enter your gift voucher code here" name="egift_code" value="" id="egift_code">')})}),t("#totaldiv").on("click","#customer_button",function(){var o="",i="",n="",r="",c=0,l=0,u='checked="checked"';e.index("type").each(function(t){var e=t.value;c=e.value.customer_id,l=e.value.customer_group_id,o=e.value.firstname,i=e.value.lastname,n=e.value.email,r=e.value.telephone,comment_str=e.comment,u=""},"customer").then(function(){var s='<div><div id="errormsg"></div><form id="customer_form" onSubmit="return false;" >';s+='<div id="search_customer"><input type="text" id="customer-text" name="value" value=""  placeholder="Enter name, phone, email to search"></div>',s+='<input id="customer_id" name="customer_id" type="hidden" value="'+c+'">',s+='<input id="customer_group_id" name="customer_group_id" type="hidden" value="'+l+'">';var p='<ul id="new-customer-form">';p+='<li><div id="label">First Name:</div><div id="input"><input type="text" name="firstname" value="'+o+'" /></div></li>',p+='<li><div id="label">Last Name:</div><div id="input"><input type="text" name="lastname" value="'+i+'"/></div></li>',p+='<li><div id="label">Email:</div><div id="input"><input type="text" name="email" value="'+n+'"/></div></li>',p+='<li><div id="label">Phone Number:</div><div id="input"><input type="text" name="telephone" value="'+r+'"/></div></li>',p+='<li><input type="checkbox" '+u+' name="new_customer" value="1">Create new account ?</li>',p+="</ul>",s+='<div id="search_customer_result">'+p+"</div>",s+="</form></div>",t(".ui-dialog-titlebar-close").trigger("click"),t(s).dialog({title:"Customer Details",modal:!0,overlay:{backgroundColor:"#000",opacity:.5},buttons:{Apply:function(){var o=t("input[name=firstname]").val(),i=t("input[name=lastname]").val(),n=t("input[name=email]").val(),r=t("input[name=telephone]").val(),c=t("input[name=new_customer]").val(),l=t("input[name=customer_id]").val(),u=t("input[name=customer_group_id]").val(),s=!1,p=t(this);return C(n)?""==r?(t("#errormsg").html('<span style="color:red;">Phone number can not empty.</span>'),!1):void e.index("type").each(function(t){s=!0;var a=t.value;tmp=new Object,tmp.id=a.id,tmp.type="customer",tmp.value=new Object,tmp.value.customer_id=l,tmp.value.firstname=o,tmp.value.lastname=i,tmp.value.email=n,tmp.value.telephone=r,tmp.value.createnew=c,tmp.value.customer_group_id=u,a=tmp,e.put(a).done(function(){d(),p.dialog("close").remove()})},"customer").then(function(){s||(tmp=new Object,tmp.type="customer",tmp.value=new Object,tmp.value.customer_id=l,tmp.value.firstname=o,tmp.value.lastname=i,tmp.value.email=n,tmp.value.telephone=r,tmp.value.createnew=c,tmp.value.customer_group_id=u,e.add(tmp).done(function(){e.index("type").each(function(t){var o=t.value;a.get(o.product_id).done(function(t){if(t.special.length>0){var a=t.special,i=new Array;for(var n in a)if(a[n].customer_group_id==u){var r=new Date,c=r.getDate(),l=r.getMonth()+1,s=r.getFullYear();parseInt(c)<10&&(c="0"+c),parseInt(l)<10&&(l="0"+l);var p=a[n].date_start,v=a[n].date_end,m=s+"-"+l+"-"+c;(new Date(m).getTime()>new Date(p).getTime()||"0000-00-00"==p)&&(new Date(m).getTime()<new Date(v).getTime()||"0000-00-00"==v)&&i.push(a[n])}if(i.length>0){var f=D(i,"priority"),_=f[0].price;o.price_no_opt=_;var h=o.options,y=0;if(h.length>0)for(n in h){var b=h[n];b.price&&("+"==b.price_prefix?(_=parseFloat(_)+parseFloat(b.price),y=parseFloat(y)+parseFloat(b.price)):(_=parseFloat(_)-parseFloat(b.price),y=parseFloat(y)-parseFloat(b.price)))}o.price=_,o.opt_total_price=y,o.subtotal=o.price*o.qty+o.tax.total,e.put(o).done(function(){g(o.id,function(){d()})})}}})},"product"),d(),p.dialog("close").remove()}))}):(t("#errormsg").html('<span style="color:red;">Your email incorrect.</span>'),!1)},Cancel:function(){return t(this).dialog("close").remove(),!1}}}),t("#customer-text").autocomplete({source:function(e,a){t.ajax({url:data_url,dataType:"json",data:{action:"customersearch",term:e.term},success:function(e){a(t.map(e,function(e){t("<div />").html(e.label);return{label:e.label,value:e.label,email:e.email,telephone:e.telephone,firstname:e.firstname,lastname:e.lastname,customer_id:e.value,customer_group_id:e.customer_group_id}}))}})},minLength:2,select:function(e,a){console.log(a);var o=a.item;t("input[name=firstname]").val(o.firstname),t("input[name=lastname]").val(o.lastname),t("input[name=email]").val(o.email),t("input[name=email]").attr("disabled","disabled"),t("input[name=telephone]").val(o.telephone),t("input[name=customer_id]").val(o.customer_id),t("input[name=customer_group_id]").val(o.customer_group_id),t("input[name=new_customer]").removeAttr("checked")},open:function(){t(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){t(this).removeClass("ui-corner-top").addClass("ui-corner-all")}})})}),t("#totaldiv").on("click","#order_comment",function(){var a="";e.index("type").each(function(t){check=!0;var e=t.value;a=e.comment},"comment").then(function(){var o=t('<div id="commentbox"><textarea style="width:262px;" id="order_comment_textarea">'+a+"</textarea></div>");t(".ui-dialog-titlebar-close").trigger("click"),o.dialog({title:"Comment Details",modal:!0,overlay:{backgroundColor:"#000",opacity:.5},buttons:{Apply:function(){var a=t("#order_comment_textarea").val(),o=!1,i=t(this);e.index("type").each(function(t){o=!0;var n=t.value;n.comment=a,e.put(n).done(function(){d(),i.dialog("close").remove()})},"comment").then(function(){o||(tmp=new Object,tmp.type="comment",tmp.comment=a,e.add(tmp).done(function(){d(),i.dialog("close").remove()}))})},Cancel:function(){return t(this).dialog("close").remove(),!1}}})})}),t("input[name='total_paid']").change(function(){var e=t("input[name='total_paid']").val(),a=config.currency.number_format,o=numeral(e).format(a),i=t("#total_able span").attr("total");t("input[name='total_paid']").val(o);var n=numeral(parseFloat(e)-parseFloat(i)).format(config.currency.default_format);t("#refund_value span").html(n)}),t("#botbuttons button#hold").click(function(){var a=t('<div><div id="discount-message"></div><input type="text" id="hold_name" name="hold_name" placeholder="Enter your hold name"></div>');t(".ui-dialog-titlebar-close").trigger("click"),a.dialog({title:"Hold Cart",modal:!0,overlay:{backgroundColor:"#000",opacity:.5},buttons:{Apply:function(){var a=t(this),o=t("#hold_name").val();if(""==o)t("#discount-message").html("Please enter your hold name.");else{var i=t.indexedDB(F).objectStore("cart_saved"),n=new Array;e.each(function(t){n.push(t.value)}).done(function(){var r=new Object;r.name=o,r.data=n;var c=new Date,l=c.getDate()+"/"+c.getMonth()+"/"+c.getFullYear()+" "+c.getHours()+":"+c.getMinutes();r.time=l,i.add(r).done(function(){e.clear().done(function(){t("#total_paid input").val("0"),d(),a.dialog("close").remove()})})})}},Cancel:function(){return t(this).dialog("close").remove(),!1}}})}),t("#saved_count").click(function(){var a=t.indexedDB(F).objectStore("cart_saved"),o=Math.floor(100*Math.random()+1),n='<div><table id="cart_saved_list" class="cart_saved_'+o+'" width="100%">';n+="<tr><th>Name</th><th>Date Created</th><th>Action</th></tr>",a.each(function(t){n+='<tr><td><a href="javascript:void(0);" id="item_saved_name" data="'+t.value.id+'">'+t.value.name+"</a></td><td>"+t.value.time+'</td><td><a id="item_saved_delete" href="javascript:void(0);" data="'+t.value.id+'">delete</a></td></tr>'}).done(function(){n+="</table></div>",t(".ui-dialog-titlebar-close").trigger("click"),t(n).dialog({title:"Hold Cart",modal:!0,overlay:{backgroundColor:"#000",opacity:.5},buttons:{Cancel:function(){return t(this).dialog("close").remove(),!1}}}),t(".cart_saved_"+o).on("click","#item_saved_name",function(){var o=t(this).attr("data");a.get(parseInt(o)).done(function(a){e.clear().done(function(){t("#total_paid input").val("0");for(i in a.data){var o=a.data[i];o.type&&e.add(o).done(function(){})}})}).then(function(){d()})}),t(".cart_saved_"+o).on("click","#item_saved_delete",function(){var e=t(this).attr("data"),o=t(this);a["delete"](parseInt(e)).done(function(){o.closest("tr").hide(),d()})})})}),t("button#payment").click(function(){var a=parseFloat(numeral().unformat(t("#total-payable").attr("total"))),o=t('input[name="total_paid"]').val(),n=parseFloat(numeral().unformat(o))-parseFloat(a),r="";if(0==parseFloat(a)){var r="<div><center>"+Mustache.render("{{checkout_cart_empty_warning}}",lang)+"</center></div>";t(".ui-dialog-titlebar-close").trigger("click"),t(r).dialog({title:Mustache.render("{{checkout_warning}}",lang),modal:!0,overlay:{backgroundColor:"#000",opacity:.5},buttons:{Cancel:function(){return t(this).dialog("close").remove(),!1}}})}else{var c=t("#product-cart-list tr.require").length;if(c>0){var r="<div><center>"+Mustache.render("{{checkout_product_option_require_warning}}",lang)+"</center></div>";t(".ui-dialog-titlebar-close").trigger("click"),t(r).dialog({title:Mustache.render("{{checkout_warning}}",lang),modal:!0,overlay:{backgroundColor:"#000",opacity:.5},buttons:{Cancel:function(){return t(this).dialog("close").remove(),!1}}})}else{{var l=new Array;t(this)}e.each(function(t){l.push(t.value)}).done(function(){var r=new Object;r.grand_total=a,r.total_paid=numeral().unformat(o),r.balance=n,r.data=l;var c=new Date((new Date).getTime()-(72e5+6e4*(new Date).getTimezoneOffset()));c=new Date,r.invoice_id=Math.round(c.getTime()/1e3),r.created_time=Math.round(c.getTime()/1e3),r.status=0,r.store_id=config.store.store_id,r.default_customer=config.default_customer,r.cash_user_id=config.cash_user_id;var d=new Array,u=new Array,s=0;for(i in l){if("discount"==l[i].type){if(l[i].value.coupon){var p=new Object;p.type="coupon",p.value=l[i].value.coupon,d.push(p)}if(l[i].value.egift){var p=new Object;p.type="egift",p.value=l[i].value.egift,d.push(p)}if(l[i].value.custom){var p=new Object;p.type="custom",p.value=l[i].value.custom,d.push(p)}}if("product"==l[i].type){s+=l[i].tax.total;for(j in l[i].tax.tax){var m=l[i].tax.tax[j],f=!1;for(k in u)if(m.tax_rate_id==u[k].tax_rate_id){u[k].total=u[k].total+m.tax_price*l[i].qty;var f=!0}f||(m.total=m.tax_price*l[i].qty,u.push(m))}}}r.tax_total=s,r.tax=u,r.discount=d;var _=(new Date,config.currency.default_format,0),d=0;for(i in r.data){var h=r.data[i];if("product"==h.type){if(h.options.length>0){var y="";for(j in h.options){var g=h.options[j];y=g.name+": "+g.value+"; "}}_+=parseFloat(h.subtotal)}}for(i in r.discount){var b=r.discount[i];d+="custom"==b.type?"P"==b.value.type?_*b.value.price/100:b.value.price:b.value.amount
}var x=t.indexedDB(F).objectStore("pos");x.get("quick_checkout").done(function(a){x.get("default_payment").done(a&&1==a.value?function(a){var o=!1;if(a&&a.value>0){for(i in payment)if(item=payment[i],console.log(payment),a.value==item.payment_id){o=item;var n=o.payment_id,c="",l=o.payment_name,d=new Array,u=t(this),s=new Object;s.name=n,s.id=n,s.ref=c,s.title=l,r.payment=s,r.cashier=cashier_name,e.each(function(t){d.push(t.value)}).done(function(){v(r,u,d)})}}else alert("Please choose 1 default payment method.")}:function(a){var o="<div id='panel-payment'><div id='discount-message'></div><form id='payment_method'><ul>";for(i in payment){var n=payment[i];o+=a?a.value==n.payment_id?'<li><input type="radio" name="pay" id="pay-'+n.payment_id+'" checked="checked" value="'+n.payment_id+'" title="'+n.payment_name+'"><button type="button" onClick="setPayment('+n.payment_id+');">'+n.payment_name+"</button></li>":'<li><input type="radio" name="pay" id="pay-'+n.payment_id+'" value="'+n.payment_id+'" title="'+n.payment_name+'"><button  type="button" onClick="setPayment('+n.payment_id+');">'+n.payment_name+"</button></li>":0==i?'<li><input type="radio" id="pay-'+n.payment_id+'" name="pay" checked="checked" value="'+n.payment_id+'" title="'+n.payment_name+'"><button  type="button" onClick="setPayment('+n.payment_id+');">'+n.payment_name+"</button></li>":'<li><input type="radio" id="pay-'+n.payment_id+'" name="pay" value="'+n.payment_id+'" title="'+n.payment_name+'"><button  type="button" onClick="setPayment('+n.payment_id+');">'+n.payment_name+"</buton></li>"}o+='<li id="payment_ref">'+Mustache.render("{{payment_ref}}",lang)+'<input type="text" name="pay_ref" value=""></li>',o+="</ul></form></div>",t(".ui-dialog-titlebar-close").trigger("click"),t(o).dialog({title:Mustache.render("{{payment_method_title}}",lang),modal:!0,overlay:{backgroundColor:"#000",opacity:.5},buttons:{Checkout:function(){var a=t('input[name="pay"]:checked').val(),o=t('input[name="pay_ref"]').val(),i=t('input[name="pay"]:checked').attr("title");if(null==a)t("#discount-message").html(Mustache.render("{{payment_method_warning}}",lang));else{var n=new Array,c=t(this),l=new Object;l.name=a,l.id=a,l.ref=o,l.title=i,r.payment=l,r.cashier=cashier_name,e.each(function(t){n.push(t.value)}).done(function(){v(r,c,n)})}},Cancel:function(){return t(this).dialog("close").remove(),!1}}})})})})}}}),t("form#barcode_scanner").on("submit",function(){var a=t("input#scancode").val().toLowerCase(),o=t.indexedDB(F).objectStore("product");return o.index("upc").get(a).then(function(a){if(a&&a.product_id){var o=a.product_id,i=!1;e.index("product_id").each(function(o){0==a.options.length&&(i=!0,o.value.qty=o.value.qty+1,o.value.subtotal=String(parseFloat(o.value.subtotal)+parseFloat(o.value.price)),e.put(o.value).done(function(){d(),t("input#scancode").val("")}))},o).done(function(){i||h(a.product_id,1,function(o){var i=new Object;i.price=o.price,i.price_no_opt=o.price,i.base_price=o.base_price,i.qty=1,i.name=a.name,i.model=a.model,i.point=a.points,i.type="product",i.product_id=a.product_id,i.options=new Array,i.subtotal=o.price,i.tax_class_id=a.tax_class_id,i.tax=new Object,i.tax.total=0,i.tax.tax=new Array,i.tax.modified=!1,e.add(i).done(function(t){g(t,function(){d()})}).then(function(){t("input#scancode").val("")})})})}}),!1}),t("#scancode").autocomplete({source:function(e,a){var o=e.term.toLowerCase(),i=t.indexedDB(F).objectStore("product"),n=new Array,r=0;i.each(function(t){var e=t.value;if(-1!=String(e.name).toLowerCase().search(o)||-1!=String(e.model).toLowerCase().search(o)||-1!=String(e.upc).toLowerCase().search(o)){if(n.push(e),r>=20)return!1;r++}}).done(function(){var e=t("input#scancode").val().toLowerCase();a(t.map(n,function(e){t("<div />").html(e.name);return{label:e.name,value:e.upc,product_id:e.product_id}})),1==n.length&&n[0].upc==e&&t("#scancode").autocomplete("close")})},minLength:2,select:function(t,e){e.item},open:function(){t(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){t("form#barcode_scanner").trigger("submit"),t(this).removeClass("ui-corner-top").addClass("ui-corner-all"),t("#scancode").autocomplete("instance")}}),t("#refund a").click(function(){var e=t.indexedDB(F).objectStore("order"),a="";a+='<div class="order-list-panel">',a+='<div class="jcarousel-orders-wrapper">',a+='<div class="jcarousel-orders"><ul>';var o=new Array;e.each(function(t){var e=t.value,a=new Date(1e3*e.invoice_id),i="Guest";for(var n in e.data){var r=e.data[n];"customer"==r.type&&(i="",""!=r.value.firstname&&(i+=r.value.firstname+" "),""!=r.value.firstname&&(i+=r.value.lastname))}var c=e.payment.title,l=e.cashier,d=config.currency.default_format;thml=void 0!=typeof e.canceled&&parseInt(e.canceled)>0?"<tr><td>"+e.invoice_id+"</td><td>"+i+"</td><td>"+numeral(e.grand_total).format(d)+"</td><td>"+numeral(e.total_paid).format(d)+"</td><td>"+numeral(e.balance).format(d)+"</td><td>"+c+"</td><td>"+l+"</td><td>"+a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear()+'</td><td><a  href="javascript:void(0);" order-id="'+e.id+'" class="order-list-print">print</a></td></tr>':"<tr><td>"+e.invoice_id+"</td><td>"+i+"</td><td>"+numeral(e.grand_total).format(d)+"</td><td>"+numeral(e.total_paid).format(d)+"</td><td>"+numeral(e.balance).format(d)+"</td><td>"+c+"</td><td>"+l+"</td><td>"+a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear()+'</td><td><a href="javascript:void(0);" class="order-list-cancel" order-id="'+e.id+'">cancel</a> | <a  href="javascript:void(0);" order-id="'+e.id+'" class="order-list-print">print</a></td></tr>',o.push(thml)}).then(function(){var e="<thead><tr><th>Invoice</th><th>Customer</th><th>Grand Total</th><th>Total Paid</th><th>Balance</th><th>Payment</th><th>Cashier</th><th>Time</th><th>Action</th></tr></thead>",i='<li><table width="650">'+e;o.reverse();var n=0;for(var r in o){var c=parseInt(r)+1;i+=c%6==0?r==o.length-1?o[r]+"</table></li>":o[r]+'</table></li><li><table width="650">'+e:r==o.length-1?o[r]+"</table></li>":o[r],n++}0==n&&(i+='<tr><td colspan="9">No orders around 24hrs</td></tr></table></li>'),a+=i+"</ul></div>",a+="</div>",a+='<div class="pagination-control">',a+='<a href="javascript:void(0);" class="orders-jcarousel-control-prev">&lsaquo;</a>',a+='<a href="javascript:void(0);" class="orders-jcarousel-control-next">&rsaquo;</a>',a+="</div>",a+="</div>",t(".ui-dialog-titlebar-close").trigger("click"),t(a).dialog({title:"Orders List",minHeight:300,minWidth:700,modal:!0,create:function(){t(".jcarousel-orders").jcarousel(),t(".orders-jcarousel-control-prev").on("jcarouselcontrol:active",function(){t(this).removeClass("inactive")}).on("jcarouselcontrol:inactive",function(){t(this).addClass("inactive")}).jcarouselControl({target:"-=1"}),t(".orders-jcarousel-control-next").on("jcarouselcontrol:active",function(){t(this).removeClass("inactive")}).on("jcarouselcontrol:inactive",function(){t(this).addClass("inactive")}).jcarouselControl({target:"+=1"})}})})}),t("body").on("click","#refund-list .pagination .links a",function(){var e=t(this).attr("href");return t.ajax({url:e,success:function(e){t("body #refund-list").html(e)}}),!1}),t("#transaction a").click(function(){var e=t("<div id='transaction-list'></div>");t.ajax({url:transaction_url,success:function(a){e.html(a).dialog({modal:!0,minWidth:800,title:Mustache.render("{{transaction_title}}",lang),close:function(){t("#transaction-list").remove()}}).dialog("open")}})}),t("#calculator-panel a").click(function(e){e.preventDefault();var a=t("#calculator"),o='<div class="top"><span class="clear">C</span><div class="screen"></div></div><div class="keys"><span>7</span><span>8</span><span>9</span><span class="operator">+</span><span>4</span><span>5</span><span>6</span><span class="operator">-</span><span>1</span><span>2</span><span>3</span><span class="operator">/</span><span>0</span><span>.</span><span class="eval">=</span><span class="operator">x</span></div>';a.html(o).dialog({modal:!0,minWidth:400,title:Mustache.render("{{calculator_title}}",lang)}).dialog("open"),calculator()}),t("body").on("click","#transfer-btn",function(){t.ajax({type:"post",url:add_transaction_url,data:t("body #frm-transfer").serialize(),dataType:"json",success:function(e){"1"==e.status&&(t("body #transactions-list tbody").prepend(e.html),t("body .transaction-total").html(e.total),t("body #frm-transfer")[0].reset(),setInterval(function(){t("body .new-trans").removeClass("new-trans")},5e3))}})}),t("body").on("click","#help a",function(){var e=t("<div id='help-form'></div>"),a='<div style="text-align: center;font-weight: bold;">Get Suport or Report Bug</div><ul>';a+="<li>SkypeId: vna_typn",a+='<li>Email: <a href="mailto:support@magetop.com">support@magetop.com</a></li>',a+='<li>Website: <a href="http://magetop.com">magetop.com</a></li>',a+="</ul>",t(".ui-dialog-titlebar-close").trigger("click"),e.html(a).dialog({modal:!0})}),t("body").on("click","#transaction-list .pagination .links a",function(){var e=t(this).attr("href");return t.ajax({url:e,success:function(e){t("body #transaction-list").html(e)}}),!1}),t("body").on("click","#refund-btn",function(){var a=t(this).attr("order_id");t("#refund-list").dialog("close"),t("#refund-list").remove();var o=t("<div id='refund-form'></div>");t.ajax({url:refund_url,type:"post",data:{order_id:a},success:function(i){o.html(i).dialog({modal:!0,minWidth:800,title:"Orders #"+a,close:function(){t("#refund-form").remove()},buttons:{Apply:function(){var a=t(this);e.clear().done(function(){a.dialog("close").remove()})},Cancel:function(){return t(this).dialog("close").remove(),!1}}}).dialog("open")}})}),t("body").on("change","#item_price",function(){var e=t(this).attr("item_id"),a=t.indexedDB(F).objectStore("cart"),o=t(this).val();e=parseInt(e),a.get(e).done(function(t){t.price=o,t.subtotal=t.price*t.qty,a.put(t).done(function(){g(e,function(){d()})})})}),t(document).on("click","#setting-panel",function(){var e=t.indexedDB(F).objectStore("pos"),a="";e.get("default_payment").done(function(t){a+='<div class="setting-box">',a+="<form>",a+='<div class="setting-payment">',a+='<div class="setting-title">Default Payment Method</div>',a+='<ul style="list-style:none;">';for(i in payment){var e=payment[i];a+=t&&e.payment_id==t.value?'<li><input type="radio" name="default-payment" id="pay-'+e.payment_id+'" checked="checked" value="'+e.payment_id+'" title="'+e.payment_name+'">'+e.payment_name+"</li>":'<li><input type="radio" name="default-payment" id="pay-'+e.payment_id+'" value="'+e.payment_id+'" title="'+e.payment_name+'">'+e.payment_name+"</li>"}a+="</ul>",a+="</div>"}).then(function(){e.get("quick_checkout").done(function(t){a+='<div class="setting-quick-checkout">',a+='<div class="setting-title">Enable Quick Checkout</div>',a+='<ul style="list-style: none;">',t&&1==t.value?(a+='<li><input name="quick_checkout" type="radio" value="0">No</li>',a+='<li><input name="quick_checkout" type="radio" value="1" checked="checked">Yes</li>'):(a+='<li><input name="quick_checkout" type="radio" value="0" checked="checked">No</li>',a+='<li><input name="quick_checkout" type="radio" value="1">Yes</li>'),a+="</form>",a+="</div>"}).then(function(){e.get("disable_print_receipt").done(function(t){a+='<div class="setting-print-receipt">',a+='<div class="setting-title">Print Receipt</div>',a+='<ul style="list-style: none;">',t&&1==t.value?(a+='<li><input name="disable_print_receipt" type="radio" value="0">Yes</li>',a+='<li><input name="disable_print_receipt" type="radio" value="1" checked="checked">No</li>'):(a+='<li><input name="disable_print_receipt" type="radio" value="0" checked="checked">Yes</li>',a+='<li><input name="disable_print_receipt" type="radio" value="1">No</li>'),a+="</ul>",a+="</div>",a+="</form>",a+="</div>"}).then(function(){t(".ui-dialog-titlebar-close").trigger("click"),t(a).dialog({title:"Setting",modal:!0,overlay:{backgroundColor:"#000",opacity:.5},buttons:{Apply:function(){var a=t('input[name="default-payment"]:checked').val(),o=t('input[name="quick_checkout"]:checked').val(),i=t('input[name="disable_print_receipt"]:checked').val(),n=new Object;n.key="default_payment",n.value=a,e.put(n).done(function(){});var r=new Object;r.key="quick_checkout",r.value=o,e.put(r).done(function(){});var c=new Object;return c.key="disable_print_receipt",c.value=i,e.put(c).done(function(){}),t(this).dialog("close").remove(),!1},Cancel:function(){return t(this).dialog("close").remove(),!1}}})})})})}),t("body").on("click",".order-list-cancel",function(){var e=t(this),a="";a+='<form id="cancel-order-form">',a+='<div class="cancel-order-title">Refund with Cash</div>',a+='<div class="cancel-order-title"><ul><li><input type="radio" checked="true" name="cancel_order_refund" value="1">Yes</li><li> <input type="radio" name="cancel_order_refund" value="0">No</li></ul></div>',a+="</form>",t(".ui-dialog-titlebar-close").trigger("click"),t(a).dialog({title:"Cancel Order",modal:!0,overlay:{backgroundColor:"#000",opacity:.5},buttons:{Apply:function(){var a=t.indexedDB(F).objectStore("order"),o=t("#cancel-order-form input[type='radio']:checked").val(),i=e.attr("order-id"),n=t(this);return a.get(parseInt(i)).done(function(t){console.log(t),t.canceled=1,t.cash_refund=o,a.put(t).done(function(){e.hide(),n.dialog("close").remove()})}),!1},Cancel:function(){return t(this).dialog("close").remove(),!1}}})}),t(document).keyup(function(e){27==e.keyCode&&t("#botbuttons #cancel").trigger("click")}),t("body").on("click",".order-list-print",function(){var e=t(this),a=e.attr("order-id"),o=t.indexedDB(F).objectStore("order");o.get(parseInt(a)).done(function(e){var a=new Date,o=1e3*e.created_time;a.setTime(o);var n=config.currency.default_format,r="<!DOCTYPE HTML>";r+='<html lang="en-us">',r+="<head></head>",r+="<body>",r+=receipt_template,r+="</body>",r+="</html>";var c=new Array,l=0,d=0;for(i in e.data){var u=e.data[i];"product"==u.type&&(u.price_formated=numeral(u.price).format(n),u.subtotal_formated=numeral(u.subtotal).format(n),u.tax_formated=numeral(u.tax.total).format(n),c.push(u),l+=parseFloat(u.subtotal))}for(i in e.discount){var s=e.discount[i];d+="custom"==s.type?"P"==s.value.type?l*s.value.price/100:s.value.price:s.value.amount}var p=new Object,v="";for(i in e.data){var u=e.data[i];"customer"==u.type&&(p=u.value),"comment"==u.type&&(v=u.comment)}var m={date:a.getDate()+"/"+(parseInt(a.getMonth())+1)+"/"+a.getFullYear(),time:a.getHours()+":"+a.getMinutes(),invoice:config.store.config_invoice_prefix+e.invoice_id,invoice_prefix:config.store.config_invoice_prefix,products:c,discount:d,subtotal:l,discount:d,tax:e.tax_total,total_paid:e.total_paid,balance:e.balance,grand_total:e.grand_total,payment_method:e.payment.title,subtotal_formated:numeral(l).format(n),tax_formated:numeral(e.tax_total).format(n),discount_formated:numeral(d).format(n),grandtotal_formated:numeral(e.grand_total).format(n),total_paid_formated:numeral(e.total_paid).format(n),balance_formated:numeral(e.balance).format(n),customer:p,cashier:cashier_name,comment:v},r=Mustache.render(r,m),f=t.indexedDB(F).objectStore("pos"),_=0;f.get("disable_print_receipt").done(function(t){t&&1==t.value&&(_=1)}).then(function(){if(0==_){var t=window.open("","_blank","width=700,height=800");t.document.writeln(r),t.document.close(),t.focus(),t.print(),w(t)}})})})}function v(e,a,o){var n=t.indexedDB(F).objectStore("cart"),r=t.indexedDB(F).objectStore("order");r.add(e).done(function(){n.clear().done(function(){t("#total_paid input").val("0"),d(),a.dialog("close").remove()}).then(function(){t("#total_paid input").val("0"),d()}).then(function(){var a=new Date,n=config.currency.default_format,r="<!DOCTYPE HTML>";r+='<html lang="en-us">',r+="<head></head>",r+="<body>",r+=receipt_template,r+="</body>",r+="</html>";var c=new Array,l=0,d=0;for(i in e.data){var u=e.data[i];"product"==u.type&&(u.price_formated=numeral(u.price).format(n),u.subtotal_formated=numeral(u.subtotal).format(n),u.tax_formated=numeral(u.tax.total).format(n),c.push(u),l+=parseFloat(u.subtotal))}for(i in e.discount){var s=e.discount[i];d+="custom"==s.type?"P"==s.value.type?l*s.value.price/100:s.value.price:s.value.amount}var p=new Object,v="";for(i in o)"customer"==o[i].type&&(p=o[i].value),"comment"==o[i].type&&(v=o[i].comment);var m=1e3*e.created_time;a.setTime(m);var f={date:a.getDate()+"/"+(parseInt(a.getMonth())+1)+"/"+a.getFullYear(),time:a.getHours()+":"+a.getMinutes(),invoice:config.store.config_invoice_prefix+e.invoice_id,invoice_prefix:config.store.config_invoice_prefix,products:c,discount:d,subtotal:l,discount:d,tax:e.tax_total,total_paid:e.total_paid,balance:e.balance,grand_total:e.grand_total,payment_method:e.payment.title,subtotal_formated:numeral(l).format(n),tax_formated:numeral(e.tax_total).format(n),discount_formated:numeral(d).format(n),grandtotal_formated:numeral(e.grand_total).format(n),total_paid_formated:numeral(e.total_paid).format(n),balance_formated:numeral(e.balance).format(n),customer:p,cashier:cashier_name,comment:v},r=Mustache.render(r,f),_=t.indexedDB(F).objectStore("product");for(i in c)_.get(c[i].product_id).then(function(e){var a=parseInt(e.quantity);a>0&&(a-=parseInt(c[i].qty)),e.quantity=a,_.put(e).done(function(){t("button[value='0']#category-btn").trigger("click")})});var h=t.indexedDB(F).objectStore("pos"),y=0;h.get("disable_print_receipt").done(function(t){t&&1==t.value&&(y=1)}).then(function(){if(0==y){var t=window.open("","_blank","width=700,height=800");t.document.writeln(r),t.document.close(),t.focus(),t.print(),w(t)}})})})}function m(e,a,o){var n=t.indexedDB(F).objectStore("cart");n.get(e).done(function(t){var r=t.price_no_opt,c=0;for(i in a){var l=a[i];l.price&&("+"==l.price_prefix?(r=parseFloat(r)+parseFloat(l.price),c=parseFloat(c)+parseFloat(l.price)):(r=parseFloat(r)-parseFloat(l.price),c=parseFloat(c)-parseFloat(l.price)))}t.opt_total_price=c,t.price=r,t.subtotal=t.price*t.qty,t.options=a,n.put(t).done(function(){g(e,function(){o(t)})})})}function f(e,a){var o=t.indexedDB(F).objectStore("cart");o.get(e).done(function(t){a(t)})}function _(e,a){e=String(e);var o=t.indexedDB(F).objectStore("product");o.get(e).done(function(t){a(t)})}function h(e,a,o){e=String(e);var n=t.indexedDB(F).objectStore("product"),r=t.indexedDB(F).objectStore("pos"),c=t.indexedDB(F).objectStore("cart");r.get("default_customer_id").done(function(t){if(void 0!=typeof t.value.customer_group_id){var r=t.value.customer_group_id;c.index("type").each(function(t){r=t.value.value.customer_group_id},"customer").then(function(){n.get(e).done(function(t){if(t.price){var e=new Object;if(e.price=t.base_price,e.base_price=t.base_price,e.special_price=null,e.discount_price=null,t.special.length>0){var n=new Array;for(i in t.special)if(String(t.special[i].customer_group_id)==String(r)){var c=!1,l=!1,d=new Date,u=new Date(t.special[i].date_start),s=new Date(t.special[i].date_end);("0000-00-00"==t.special[i].date_start||d>u)&&(c=!0),("0000-00-00"==t.special[i].date_end||s>d)&&(l=!0),c&&l&&(n[t.special[i].priority]=n[t.special[i].priority]&&parseFloat(n[t.special[i].priority].base_price)<parseFloat(t.special[i].base_price)?n[t.special[i].priority]:t.special[i])}if(n.length>0){var p=Math.min.apply(Math,Object.keys(n));e.price=n[p].base_price,e.special_price=n[p].base_price}}if(t.discounts.length>0){var v=e.price;for(i in t.discounts){var m=t.discounts[i];m.quantity<=a&&parseFloat(m.price)<parseFloat(v)&&(v=m.price)}e.price=v,e.discount_price=v}o(e)}})})}})}function y(t,e){var a="",o=config.currency.default_format,a=numeral(t).format(o);e(a)}function g(e,a){var o=(t.indexedDB(F).objectStore("pos"),t.indexedDB(F).objectStore("tax")),n=t.indexedDB(F).objectStore("cart");b("tax_class_base",function(t){var r=t;if(0!=r&&-1!=r&&b("tax_base_on",function(t){var c=t;b("default_customer_id",function(t){var l=t,d=new Array;o.index("customer_group_id").each(function(t){t.value.based==c&&d.push(t.value)},l.customer_group_id).then(function(){var t=new Object;n.get(e).done(function(e){var o=new Array,c=0,l=0;for(i in d)if(d[i].tax_class_id==r){var u=d[i];if(e.qty>0){u.qty=e.qty;var s=u.rate,p=u.type,v=0,m=new Object;m.name=u.name,m.tax_rate_id=u.tax_rate_id,o[l]=m,v+="P"==p?parseFloat(e.price)/100*parseFloat(s):parseFloat(s),c+=v,o[l].tax_price=v,l++}}t.item_id=e.id,t.total=c,t.modified=!1,t.tax=o,e.tax=t,n.put(e).done(function(){a(e)})},"product")})})}),0==r){var c=new Object;n.get(e).done(function(t){var e=new Array;c.item_id=t.id,c.total=0,c.modified=!1,c.tax=e,t.tax=c,n.put(t).done(function(){a(t)})},"product")}-1==r&&b("tax_base_on",function(t){var r=t;b("default_customer_id",function(t){var c=t,l=new Array;o.index("customer_group_id").each(function(t){t.value.based==r&&l.push(t.value)},c.customer_group_id).then(function(){var t=new Object;n.get(e).done(function(e){var o=new Array,r=0,c=0;for(i in l)if(l[i].tax_class_id==e.tax_class_id){var d=l[i];if(e.qty>0){d.qty=e.qty;var u=d.rate,s=d.type,p=0,v=new Object;v.name=d.name,v.tax_rate_id=d.tax_rate_id,o[c]=v,p+="P"==s?parseFloat(e.price)/100*parseFloat(u):parseFloat(u),r+=p,o[c].tax_price=p,c++}}t.item_id=e.id,t.total=r,t.modified=!1,t.tax=o,e.tax=t,n.put(e).done(function(){a(e)})},"product")})})})})}function b(e,a){var o=t.indexedDB(F).objectStore("pos");o.get(e).done(function(t){t&&a(t.value)})}function x(){var e=t.indexedDB(F).objectStore("cart"),a=0,o=0,i=0,n=0,r="",c="",l=0,d=t.indexedDB(F).objectStore("cart_saved");d.count().done(function(e){t("#saved_count").html(parseInt(e))}),e.each(function(t){if("product"==t.value.type&&(a=parseFloat(a)+parseFloat(t.value.subtotal),i=parseFloat(i)+parseFloat(t.value.subtotal),t.value.tax.total&&(l+=parseFloat(t.value.tax.total)*parseInt(t.value.qty)),o+=t.value.qty),"comment"==t.value.type&&(r=t.value.comment),"customer"==t.value.type&&(c=t.value.value.firstname+" "+t.value.value.lastname),"discount"==t.value.type){var e=t.value.value;if(e.egift&&(n=parseFloat(n)+parseFloat(e.egift.amount),i=parseFloat(i)-parseFloat(n)),e.custom){var d=e.custom,u=d.price;if(parseFloat(d.price)<parseFloat(a))if("P"==d.type){var s=parseFloat(a)*parseFloat(u)/100;n=parseFloat(n)+parseFloat(s),i=parseFloat(i)-parseFloat(s)}else n=parseFloat(n)+parseFloat(u),i=parseFloat(i)-parseFloat(u)}}}).then(function(){t("#item_count span").html(o),i+=l;var e=config.currency.number_format;t("#total_paid input").val(numeral(i).format(e));var d=(numeral(t("#total_paid input").val()).format(e),numeral(i).format(e),numeral(parseFloat(numeral().unformat(t("#total_paid input").val()))-parseFloat(i)).format(config.currency.default_format));t("#refund_value span").html(d),y(l,function(e){t("#tax_value").html(e)}),y(a,function(e){t("#total_value span").html(e)}),y(i,function(e){t("#total_able span").html(e),t("#total_able span").attr("total",parseFloat(i))}),y(n,function(e){t("#discount_value button").html(e)}),""==r&&(r=Mustache.render("{{no_comment}}",lang)),t("#comment_value span").html(r),""!=c?t("#customer_value button").html(c):(c=void 0!=config.default_customer.customer_id?config.default_customer.firstname+" "+config.default_customer.lastname:Mustache.render("{{default_guest_name}}",lang),t("#customer_value button").html(c))})}function w(t){"complete"==document.readyState?t.close():setTimeout("CheckWindowState()",2e3)}function C(t){var e=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return e.test(t)}function D(t,e){return t.sort(function(t,a){var o=t[e],i=a[e];return i>o?-1:o>i?1:0})}const F="OpenPos";window.onbeforeunload=e,t(".menu-refresh").click(function(){t(".menu-refresh img#refresh").hide(),t(".menu-refresh img#loading").show(),t.ajax({url:data_url,faild:function(){alert("No internet connection. Your POS in Offline Mode."),t(".menu-refresh img#refresh").show(),t(".menu-refresh img#loading").hide()},success:function(){t.indexedDB(F).deleteDatabase().done(function(){a(function(){t(".menu-refresh img#refresh").show(),t(".menu-refresh img#loading").hide(),l(),p()})})}})}),a(function(){l(),p(),t("#product-cart-list").jScrollPane({showArrows:!0}),t("body").on("click",".keyboard-status #keyboard",function(){t(this).hasClass("add")?(t(".product-pad").hide(),t(".keyboard-pad").show(),t(this).removeClass("add"),t(this).addClass("del")):(t(".product-pad").show(),t(".keyboard-pad").hide(),t(this).removeClass("del"),t(this).addClass("add"),n(),t("button[value='0']#category-btn").trigger("click"))}),t("body").on("click",".keyboard-pad ul li button",function(){var e=t(this).val();switch(e){case"enter":t("form#barcode_scanner").submit();break;case"clr":var a=t('input[name="barcode"]').val();i=a.substring(0,a.length-1),t('input[name="barcode"]').val(i),t("#scancode").autocomplete("search",i);break;case"clra":t('input[name="barcode"]').val("");break;default:var o=t('input[name="barcode"]').val(),i=o+e;t('input[name="barcode"]').val(i),t("#scancode").autocomplete("search",i)}t("#scancode").focus()})})}}(jQuery);